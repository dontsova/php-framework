services:
  # Nginx Service
  nginx:
    image: nginx:stable-alpine
    container_name: framework_nginx
    ports:
      - "80:80" # Map host port 80 to container port 80
    volumes:
      - .:/var/www/html # Mount your Laravel project into Nginx's web root
      - ./docker/nginx/default.conf:/etc/nginx/conf.d/default.conf # Nginx config
    depends_on:
      - php-fpm # Nginx depends on PHP-FPM to process PHP files
    networks:
      - framework_network

  # PHP-FPM Service
  php-fpm:
    build:
      context: ./docker/php-fpm # Build from Dockerfile in this directory
      dockerfile: Dockerfile
    container_name: framework_php_fpm
    volumes:
      - .:/var/www/html # Mount your Laravel project
      - ./docker/php-fpm/php.ini:/usr/local/etc/php/conf.d/custom.ini # Custom PHP settings
    networks:
      - framework_network
    environment: # Environment variables for PHP-FPM
      PHP_IDE_CONFIG: "serverName=Docker" # For Xdebug, if you configure it later
      # Add other PHP-specific environment variables if needed
    # user: "1000:1000" # Uncomment and adjust if you have permission issues with mounted volumes (Linux only)

  # MySQL Service
  mysql:
    image: mysql:8.0
    container_name: framework_mysql
    ports:
      - "3306:3306" # Map host port 3306 to container port 3306
    environment: # MySQL root password and database name
      MYSQL_ROOT_PASSWORD: mysqladmin # Use env var from .env file
      MYSQL_DATABASE: fw_db
      MYSQL_USER: fw_db_user
      MYSQL_PASSWORD: fw_secret_password
    volumes:
      - mysql_data:/var/lib/mysql # Persistent volume for MySQL data
    networks:
      - framework_network
    healthcheck: # Optional: Check if MySQL is ready
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      timeout: 20s
      retries: 10
      interval: 10s
  
  #PHPMyAdmin
  phpmyadmin:
    image: phpmyadmin:latest
    container_name: framework-phpmyadmin
    ports:
      - 8888:80
    environment:
      - PMA_ARBITRARY=0
      - PMA_HOST=mysql
    restart: unless-stopped
    depends_on:
      - mysql
    networks:
      - framework_network

  # Docker Networks
networks:
  framework_network:
    driver: bridge # Default bridge network

# Docker Volumes (for persistent data)
volumes:
  mysql_data: # MySQL data volume
    driver: local